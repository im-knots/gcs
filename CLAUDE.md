# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Repository Overview

This is a research project analyzing AI conversation dynamics through geometric and embedding trajectory analysis. It combines Python-based data analysis with an academic LaTeX paper documenting the findings. a sample of the conversation data we are using can be found in anaysis/sample-json/

## Key Commands

### Python Analysis Environment

```bash
# Activate virtual environment
source analysis/conversation_analysis_env/bin/activate

# Install dependencies
pip install -r analysis/requirements.txt

# Run the main analysis
python analysis/analysis.py
```

### LaTeX Paper Compilation

```bash
# Build the paper (from paper/ directory)
cd paper
pdflatex paper.tex
bibtex paper
pdflatex paper.tex
pdflatex paper.tex

# Or use latexmk for automated builds
latexmk -pdf paper.tex
```

## Architecture Overview

### Analysis Pipeline (`analysis/analysis.py`)

The `EmbeddingTrajectoryAnalyzer` class orchestrates the entire analysis:

1. **Embedding Generation**: Uses sentence transformers to convert conversation text into high-dimensional embedding vectors
2. **Trajectory Analysis**: Tracks how conversations move through embedding space over time
3. **Pattern Detection**: Identifies breakdown patterns, clusters, and phase transitions
4. **Ensemble Mode**: Supports multiple embedding models to find invariant patterns across different representations

Key analysis modes:
- Single conversation analysis: `analyze_single_conversation()`
- Multi-conversation comparison: `analyze_multiple_conversations()`
- Model tier analysis: `analyze_model_tiers()` - compares full reasoning, light reasoning, and no reasoning models
- Bootstrap analysis for statistical validation

### Data Processing Flow

1. **Input**: JSON conversation files containing agent interactions
2. **Embedding**: Text converted to embedding vectors (384 or 768 dimensions)
3. **Dimensionality Reduction**: PCA, t-SNE for visualization
4. **Analysis**: Multiple geometric and statistical methods:
   - Velocity and acceleration in embedding space
   - Divergence metrics between trajectories
   - Clustering and phase identification
   - Topological analysis (persistence diagrams)
5. **Output**: Figures, CSVs, and comprehensive reports

## Important Considerations

- The project analyzes conversations from `/home/knots/git/the-academy/docs/paper/exp-data/` directories
- Default embedding model is 'all-MiniLM-L6-v2' (384 dimensions)
- Ensemble mode uses multiple models for robust pattern detection
- Analysis outputs are saved to `analysis/analysis_outputs/` by default
- The paper references specific analysis results and figures generated by the Python code
